"use strict";class Todo{constructor(){this.todoList=this.getLocalStorage("todoList")||[{"task":"The completed tasks will be shown in strikethrough","completed":true},{"task":"You can use the \": :\" icon on the left side of the task to drag, use the \"âœ•\" icon on the right side of the task to delete","completed":false},{"task":"Click the task to edit it, and press the \"Enter/Return\" key to save","completed":false},{"task":"Any changes will be automatically saved, and the record will not be lost even if you close the browser","completed":false},{"task":"Use the [1-3-5 rule](https://www.themuse.com/advice/a-better-todo-list-the-135-rule) to redefine the focus of your day, and start adding the first task ðŸ™‚","completed":false}],this.itemsParentEl=document.querySelector(".items"),this.itemEls=this.itemsParentEl.childNodes,this.newItemEl=document.querySelector(".new-item"),this.newItemLabelEl=this.newItemEl.querySelector("label"),this.newItemInputEl=this.newItemEl.querySelector("input"),this.maxTaskNumber=10,this.confettiWrapper=document.querySelector("#confetti"),this.confettiAnimation=bodymovin.loadAnimation({wrapper:this.confettiWrapper,animType:"svg",loop:!1,autoplay:!1,path:"https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/animation/7893-confetti-cannons.json"}),this.accomplishSound=new Audio("https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/audio/BOTW_Fanfare_SmallItem.wav"),this.deleteSound=new Audio("https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/audio/BotW_Interact_sound.mp3"),this.dragSound=new Audio("https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/audio/drag.mp3"),this.dropSound=new Audio("https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/audio/drop.mp3"),this.pageSound=new Audio("https://raw.githubusercontent.com/rayc2045/draggable-todoList/master/audio/page.mp3"),this.timer,this.events()}events(){this.updateTasks(),this.setNewItemElState(),this.itemEls.length<this.maxTaskNumber&&setTimeout(()=>this.newItemInputEl.focus()),this.accomplishSound.preload="auto",this.deleteSound.preload="auto",this.dragSound.preload="auto",this.dropSound.preload="auto",this.sortableJS(),this.itemsParentEl.onchange=()=>this.rearrangeTodoList(),this.itemsParentEl.ondragstart=e=>e.target.style.height=`${e.target.scrollHeight}px`,this.itemsParentEl.ondragend=()=>{this.itemEls.forEach(el=>{el.removeAttribute("draggable"),el.removeAttribute("style")}),this.newItemInputEl.focus()},this.itemsParentEl.onmousedown=e=>{if(e.target.classList.contains("handle"))return this.playSound(this.dragSound);e.target.classList.contains("content")&&(this.editEnable(e),e.target.closest(".item").removeAttribute("draggable"),e.target.closest(".item").removeAttribute("style"),e.target.onblur=e=>{if(!e.target.textContent.trim())return this.deleteTask(e);this.saveContent(e),this.editDisable(e),this.newItemInputEl.focus()})},this.itemsParentEl.onpaste=e=>{e.target.classList.contains("content")&&this.pastePlainText(e)},this.itemsParentEl.onkeydown=e=>{e.target.classList.contains("content")&&13===e.which&&this.newItemInputEl.focus()},this.itemsParentEl.onclick=e=>"checkbox"===e.target.type?(this.toggleComplete(e),this.newItemInputEl.focus()):e.target.classList.contains("delete")?(this.deleteTask(e),this.newItemInputEl.focus()):void(e.target.hasAttribute("href")&&this.playSound(this.pageSound)),this.newItemInputEl.onkeydown=e=>{if(13===e.which&&this.addTask(),this.itemEls.length>=this.maxTaskNumber)return this.inputDisable(e)},this.newItemInputEl.onblur=e=>{e.target.value.trim()||(e.target.value="")},this.newItemInputEl.onfocus=e=>{if(this.itemEls.length>=this.maxTaskNumber)return this.inputDisable(e)}}pastePlainText(e){e.preventDefault();let text=(e.clipboardData||window.clipboardData).getData("text/plain");document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,text):document.execCommand("paste",!1,text)}convertToAnchor(text){return this.getFilteredText(text).replace(/(<([^>]+)>)/gi,"").replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" target="_blank" rel="noreferrer noopener">$1</a>')}convertToMarkdown(anchor){return this.getFilteredText(anchor).replace(/(<\/?(?:a)[^>]*>)|<[^>]+>/gi,"$1").replace(/<a.*?href="(.*?)".*?>(.*?)<\/a>/g,"[$2]($1)")}getFilteredText(text){return this.capitalizeFirstLetter(String(text)).replace(/%3C/gi,"").replace(/%3E/gi,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}capitalizeFirstLetter(str){return`${str.charAt(0).toUpperCase()}${str.slice(1)}`}updateTasks(){this.itemsParentEl.innerHTML="";for(const i in this.todoList)this.appendTask(i)}appendTask(id){const item=document.createElement("li");item.id=`item_${id}`,item.classList.add("item"),item.innerHTML=this.createTaskInnerHTML(id),this.itemsParentEl.appendChild(item)}createTaskInnerHTML(id){return`\n      <div class="handle">: :</div>\n      <input type="checkbox" id="complete_${id}"${this.todoList[id].completed?" checked":""}>\n      <label class="check" for="complete_${id}">âœ“</label>\n      <div class="content">${this.convertToAnchor(this.todoList[id].task)}</div>\n      <div class="delete">âœ•</div>`}setNewItemElState(){if(this.itemEls.length<this.maxTaskNumber)return this.newItemLabelEl.textContent="ï¼‹",this.newItemInputEl.placeholder="What needs to be done?",this.newItemEl.classList.remove("forbid");this.newItemLabelEl.textContent="â€”",this.newItemInputEl.placeholder="Try to make tasks less...",this.newItemEl.classList.add("forbid")}addTask(){const input=this.newItemInputEl.value.trim();if(!input)return this.newItemInputEl.value="";this.todoList.push({task:this.getFilteredText(input).replace(/(<([^>]+)>)/gi,""),completed:!1}),this.setLocalStorage("todoList",this.todoList),this.appendTask(this.todoList.length-1),this.setNewItemElState(),this.newItemInputEl.value="",this.playSound(this.dropSound)}inputDisable(e){e.preventDefault(),e.target.value="",e.target.blur()}deleteTask(e){const item=e.target.closest(".item"),index=item.id.replace("item_","");this.todoList.splice(index,1),this.todoList.length?this.setLocalStorage("todoList",this.todoList):this.removeFromLocalStorage("todoList"),item.parentNode.removeChild(item);for(let i=index;i<this.itemEls.length;i++)this.itemEls[i].id=`item_${i}`;this.setNewItemElState(),this.playSound(this.deleteSound)}toggleComplete(e){e.preventDefault();const index=e.target.closest(".item").id.replace("item_","");if(this.todoList[index].completed=!this.todoList[index].completed,this.setLocalStorage("todoList",this.todoList),e.target.parentNode.innerHTML=this.createTaskInnerHTML(index),!e.target.checked)return this.muteGradually(this.accomplishSound);this.playSound(this.accomplishSound,.35),this.confettiAnimation.goToAndPlay(0,!0)}editEnable(e){e.target.contentEditable="true",e.target.innerHTML=this.convertToMarkdown(e.target.innerHTML)}editDisable(e){e.target.removeAttribute("contenteditable"),e.target.innerHTML=this.convertToAnchor(e.target.innerHTML)}saveContent(e){const index=e.target.closest(".item").id.replace("item_","");this.todoList[index].task=this.convertToMarkdown(e.target.innerHTML),this.setLocalStorage("todoList",this.todoList)}sortableJS(){Sortable.create(sortable,{animation:100,handle:".handle",draggable:".item",ghostClass:"dragging"})}rearrangeTodoList(){for(const i in this.todoList)this.todoList[i].completed=this.itemEls[i].childNodes[3].checked,this.todoList[i].task=this.convertToMarkdown(this.itemEls[i].childNodes[7].innerHTML),this.setLocalStorage("todoList",this.todoList),this.itemEls[i].id=`item_${i}`,this.playSound(this.dropSound)}setLocalStorage(key,value){localStorage.setItem(key,JSON.stringify(value))}getLocalStorage(key){return JSON.parse(localStorage.getItem(key))}removeFromLocalStorage(key){localStorage.removeItem(key)}playSound(audio,volume=1){audio.currentTime=0,audio.volume=volume,audio.play()}muteGradually(audio){for(let i=0;i<10;i++){let delay;setTimeout(()=>{audio.volume/=1.65},50*i)}}fakeAudioCatch(audio,minute){void 0!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{audio.currentTime=0,audio.volume=0,audio.play(),this.fakeAudioCatch(audio,minute)},60*minute*1e3)}}const todo=new Todo;document.onmousedown=e=>{const cls=e.target.classList;(cls.contains("container")||cls.contains("todo-list")||cls.contains("wrapper")||cls.contains("items")||cls.contains("item")||cls.contains("new-item"))&&setTimeout(()=>todo.newItemInputEl.focus())},document.oncontextmenu=()=>!1,document.onselectstart=e=>{try{if(!e.target.classList.contains("content"))return!1}catch(error){}},document.onmousemove=()=>{try{todo.fakeAudioCatch(todo.accomplishSound,3)}catch(error){}document.onmousemove=null};